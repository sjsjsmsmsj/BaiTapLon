<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ Hàng</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/index.css">
    <script src="../js/jquery-3.7.1.min.js"></script>
    <script src="../js/bootstrap.bundle.min.js"></script>
    <script src="../js/script.js"></script>
    <style>
        .card-img-top {
            object-fit: cover;
            height: 200px;
        }
        .btn-custom {
            background-color: #007bff;
            color: white;
            transition: background-color 0.3s;
        }
        .btn-custom:hover {
            background-color: #0056b3;
        }
        .btn-danger-custom {
            background-color: #dc3545;
            color: white;
            transition: background-color 0.3s;
        }
        .btn-danger-custom:hover {
            background-color: #c82333;
        }
        .btn-success-custom {
            background-color: #28a745;
            color: white;
            transition: background-color 0.3s;
        }
        .btn-success-custom:hover {
            background-color: #218838;
        }
        .product-card {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .product-card:hover {
            transform: scale(1.05);
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>

<body>
    <!-- Thanh điều hướng -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">Cửa Hàng</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="../html/home.html" class="nav-link">Trang chủ</a></li>
                    <li class="nav-item"><a href="../html/danhSach.html" class="nav-link">Danh sách sản phẩm</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2>Giỏ Hàng</h2>
        <div class="row" id="cart-items">
            <!-- Các sản phẩm trong giỏ hàng sẽ được hiển thị ở đây -->
        </div>
        <div class="text-end mt-4">
            <p id="total-price" class="fw-bold"></p> <!-- Hiển thị tổng tiền -->
            <button class="btn btn-primary" onclick="checkout()">Thanh toán</button>
        </div>
    </div>

    <script>
        // Hàm hiển thị giỏ hàng và tính tổng tiền
        function renderCart() {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            let container = document.getElementById("cart-items");
            container.innerHTML = ""; // Xóa nội dung giỏ hàng cũ
            let totalPrice = 0; // Biến tính tổng tiền

            if (cart.length === 0) {
                container.innerHTML = "<p>Giỏ hàng của bạn hiện tại trống.</p>";
                document.getElementById("total-price").innerHTML = "Tổng tiền: 0 VNĐ"; // Nếu giỏ hàng trống
                return;
            }

            cart.forEach(item => {
                // Kiểm tra xem giá trị 'image' có hợp lệ không
                if (!item.image || item.image === "null") return; // Nếu không hợp lệ, bỏ qua sản phẩm này

                let price = parseFloat(item.price) || 0;
                let image = item.image;

                // Cập nhật tổng tiền
                totalPrice += price * item.quantity;

                container.innerHTML += `
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 product-card">
                            <img src="${image}" class="card-img-top" alt="${item.name}">
                            <div class="card-body">
                                <h5 class="card-title">${item.name}</h5>
                                <p class="card-text text-danger fw-bold">${price.toLocaleString()} VNĐ</p>
                                <p>Số lượng: ${item.quantity}</p>
                                <button class="btn btn-danger-custom" onclick="removeItem('${item.name}')">Xóa</button>
                                <button class="btn btn-success-custom ms-2" onclick="addItem('${item.name}')">Thêm hàng</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            // Hiển thị tổng tiền
            document.getElementById("total-price").innerHTML = `Tổng tiền: ${totalPrice.toLocaleString()} VNĐ`;
        }

        // Hàm xóa sản phẩm khỏi giỏ hàng
        function removeItem(productName) {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            cart = cart.filter(item => item.name !== productName); // Lọc các sản phẩm có tên khác với tên sản phẩm muốn xóa
            localStorage.setItem("cart", JSON.stringify(cart)); // Cập nhật giỏ hàng vào localStorage
            renderCart(); // Cập nhật lại giỏ hàng sau khi xóa sản phẩm
        }

        // Hàm thêm sản phẩm vào giỏ hàng
        function addItem(productName) {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            let product = cart.find(item => item.name === productName);

            if (product) {
                product.quantity += 1; // Tăng số lượng của sản phẩm
            }

            localStorage.setItem("cart", JSON.stringify(cart)); // Cập nhật giỏ hàng vào localStorage
            renderCart(); // Cập nhật lại giỏ hàng
        }

        // Hàm thanh toán (chỉ đơn giản là thông báo ở đây, bạn có thể thêm các thao tác thanh toán khác)
        function checkout() {
            alert("Cảm ơn bạn đã mua hàng!");
            // Bạn có thể thêm chức năng thanh toán tại đây
        }

        // Gọi hàm renderCart khi trang được tải
        document.addEventListener("DOMContentLoaded", function () {
            renderCart();
        });
    </script>
</body>

</html>
